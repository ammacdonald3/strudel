{% extends "layout.html" %}
{% block nav_view_menu %}
active
{% endblock %}
{% block nav_recipes %}
active
{% endblock %}


{% block heading %}
All Recipes
{% endblock %}

{% block body %}
<br>


<div class="container">

  <p>
    <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#filters" aria-expanded="false"
      aria-controls="filters">
      Filters
    </button>
  </p>
  <div class="collapse" id="filters">
    <div class="card card-body">

      <div class="row">
        
      <!-- Breakfast / Lunch / Dinner filters -->
      <div class="col-sm">
      <h5>Meal Time</h5>
      <div class="form-group form-check">
        <input class="form-check-input big-checkbox breakfast-check" type="checkbox" value="" id="breakfast-check"
          checked>
        <label class="form-check-label align-middle" for="breakfast-check">
          Breakfast
        </label>
        <br>
        <input class="form-check-input big-checkbox lunch-check" type="checkbox" value="" id="lunch-check" checked>
        <label class="form-check-label align-middle" for="lunch-check">
          Lunch
        </label>
        <br>
        <input class="form-check-input big-checkbox dinner-check" type="checkbox" value="" id="dinner-check" checked>
        <label class="form-check-label align-middle" for="dinner-check">
          Dinner
        </label>
        <br>
        <input class="form-check-input big-checkbox meal-uncategorized-check" type="checkbox" value="" id="meal-uncategorized-check" checked>
        <label class="form-check-label align-middle" for="meal-uncategorized-check">
          Other
        </label>
      </div>
    </div>

<br>

    
      <!-- Vegan / Vegetarian / Gluten-Free Filters -->
      <div class="col-sm">
      <h5>Dietary Restrictions</h5>
      <div class="form-group form-check">
        <input class="form-check-input big-checkbox vegan-check" type="checkbox" value="" id="vegan-check" checked>
        <label class="form-check-label align-middle" for="vegan-check">
          Vegan
        </label>
        <br>
        <input class="form-check-input big-checkbox vegetarian-check" type="checkbox" value="" id="vegetarian-check"
          checked>
        <label class="form-check-label align-middle" for="vegetarian-check">
          Vegetarian
        </label>
        <br>
        <input class="form-check-input big-checkbox gluten-check" type="checkbox" value="" id="gluten-check" checked>
        <label class="form-check-label align-middle" for="gluten-check">
          Gluten-free
        </label>
        <br>
        <input class="form-check-input big-checkbox no-diet-check" type="checkbox" value="" id="no-diet-check" checked>
        <label class="form-check-label align-middle" for="no-diet-check">
          No Dietary Restrictions
        </label>
      </div>
    </div>

    

      <br>

      <div class="col-sm">
      <!-- Total Cook Time Filters -->
      <h5>Cook Time</h5>
      <div class="form-group form-check">
        <input class="form-check-input big-checkbox total-time-30-check" type="checkbox" value=""
          id="total-time-30-check" checked>
        <label class="form-check-label align-middle" for="total-time-30-check">
          Total Cook Time - 30 Minutes or Less
        </label>
        <br>
        <input class="form-check-input big-checkbox total-time-60-check" type="checkbox" value=""
          id="total-time-60-check" checked>
        <label class="form-check-label align-middle" for="total-time-60-check">
          Total Cook Time - 31 to 60 Minutes
        </label>
        <br>
        <input class="form-check-input big-checkbox total-time-90-check" type="checkbox" value=""
          id="total-time-90-check" checked>
        <label class="form-check-label align-middle" for="total-time-90-check">
          Total Cook Time - 61 to 90 Minutes
        </label>
        <br>
        <input class="form-check-input big-checkbox total-time-over-90-check" type="checkbox" value=""
          id="total-time-over-90-check" checked>
        <label class="form-check-label align-middle" for="total-time-over-90-check">
          Total Cook Time - Over 90 Minutes
        </label>
      </div>
      </div>

      <br>

      <!-- Favorite Recipe Filter -->
      <div class="col-sm">
        <h5>Other</h5>
      <div class="form-group form-check">
        <input class="form-check-input big-checkbox favorite-check" type="checkbox" value="" id="favorite-check">
        <label class="form-check-label align-middle" for="favorite-check">
          Favorite Recipes Only
        </label>
      </div>

      <!-- User's Recipe Filter -->
      <div class="form-group form-check">
          <input class="form-check-input big-checkbox user-recipe-check" type="checkbox" value="" id="user-recipe-check">
          <label class="form-check-label align-middle" for="user-recipe-check">
            Your Recipes Only
          </label>
        </div>
</div>
      </div>

    </div>
  </div>

  <div class="card-body">
    <h4 class="text-center recipe-length"><span></span> Recipes Returned</h4>
    <hr class="recipe-list-hr" />

    {% if recipe_list_exists == True %}

    <ul class="list-unstyled">
      {% for recipe in all_recipe_list %}

      <!-- Recipe Name -->
      <li class="
          {% if recipe.Recipe.meal_breakfast == True and recipe.Recipe.meal_lunch == True and recipe.Recipe.meal_dinner == True %}
          breakfast-lunch-dinner
          {% elif recipe.Recipe.meal_breakfast == False and recipe.Recipe.meal_lunch == False and recipe.Recipe.meal_dinner == False %}
          meal-uncategorized
          {% elif recipe.Recipe.meal_breakfast == True and recipe.Recipe.meal_lunch == True %}
          breakfast-lunch
          {% elif recipe.Recipe.meal_lunch == True and recipe.Recipe.meal_dinner == True %}
          lunch-dinner
          {% elif recipe.Recipe.meal_breakfast == True and recipe.Recipe.meal_dinner == True %}
          breakfast-dinner
          {% elif recipe.Recipe.meal_breakfast == True %}
          breakfast
          {% elif recipe.Recipe.meal_lunch == True %}
          lunch
          {% elif recipe.Recipe.meal_dinner == True %}
          dinner
          {% endif %}

          {% if recipe.Recipe.diet_vegan == True and recipe.Recipe.diet_vegetarian == True and recipe.Recipe.diet_gluten == True %}
          vegan-vegetarian-gluten
          {% elif recipe.Recipe.diet_vegan == False and recipe.Recipe.diet_vegetarian == False and recipe.Recipe.diet_gluten == False %}
          no-diet
          {% elif recipe.Recipe.diet_vegan == True and recipe.Recipe.diet_vegetarian == True %}
          vegan-vegetarian
          {% elif recipe.Recipe.diet_vegetarian == True and recipe.Recipe.diet_gluten == True %}
          vegetarian-gluten
          {% elif recipe.Recipe.diet_vegan == True and recipe.Recipe.diet_gluten == True %}
          vegan-gluten
          {% elif recipe.Recipe.diet_vegan == True %}
          vegan
          {% elif recipe.Recipe.diet_vegetarian == True %}
          vegetarian
          {% elif recipe.Recipe.diet_gluten == True %}
          gluten
          {% endif %}
        
          {% if recipe.Recipe.recipe_total_time <= 30 %}
          total-time-30
          {% elif recipe.Recipe.recipe_total_time <= 60 %}
          total-time-60
          {% elif recipe.Recipe.recipe_total_time <= 90 %}
          total-time-90
          {% else %}
          total-time-over-90
          {% endif %}

          {% if recipe.Favorite_Recipe.app_user_id == current_user.id and recipe.Favorite_Recipe.favorite_recipe_id != None %}
          favorite
          {% else %}
          not-favorite
          {% endif %}

          {% if recipe.Recipe.created_by == current_user.id %}
          user-recipe
          {% else %}
          not-user-recipe
          {% endif %} 
          recipe-item

      ">
        <a href="{{ url_for('recipe_detail', recipe_id=recipe.Recipe.recipe_id) }}" class="text-decoration-none">
          <h3 class="text-center">{{ recipe.Recipe.recipe_name }}</h3>
          <!-- Recipe Prep/Cook Time -->
          <h6 class="text-center">
            {% if recipe.Recipe.recipe_total_time != None %}
            ({{ recipe.Recipe.recipe_total_time }} minutes total prep/cook time)
            {% endif %}
          </h6>
          <!-- Badges indicating if the recipe is for Breakfast, Lunch, and/or Dinner -->
          <div class="mealtime-badge d-flex justify-content-center">
            {% if recipe.Recipe.meal_breakfast == True %}
            <span class="badge badge-pill badge-success">Breakfast</span>
            {% endif %}
            {% if recipe.Recipe.meal_lunch == True %}
            <span class="badge badge-pill badge-success">Lunch</span>
            {% endif %}
            {% if recipe.Recipe.meal_dinner == True %}
            <span class="badge badge-pill badge-success">Dinner</span>
            {% endif %}
          </div>
          <!-- Recipe Image -->
          {% if recipe.Recipe.recipe_image_url != None %}
          <img id="preview" src="{{ recipe.Recipe.recipe_image_url}}" class="center rounded img-fluid small-image"
            alt="Responsive image" />
          {% else %}
          <img id="preview" src="/static/placeholder-recipe-image.jpg" class="center rounded img-fluid small-image"
            alt="Responsive image" />
          {% endif %}
        </a>

        <div class="form-group">

          <div class="row" style="padding-top: 20px;">
            <!-- Display button so that user can view recipe's page -->
            <div class="form-group col-sm">
              <a href="{{ url_for('recipe_detail', recipe_id=recipe.Recipe.recipe_id) }}"
                class="btn btn-primary btn-block">View Recipe</a>
            </div>

            <!-- Display button so that user can view recipe's source website -->
            <div class="form-group col-sm">
              <a href="https://{{ recipe.Recipe.recipe_url }}" target="_blank" class="btn btn-primary btn-block">Source
                Website</a>
            </div>
          </div>
          <div class="row">
            <!-- Display button so that user can add the recipe to their current meal plan via subsequent buttons on modal -->
            <div class="form-group col-sm">
              <button name="{{ recipe.Recipe.recipe_id }}" id="meal-{{ recipe.Recipe.recipe_id }}" class="meal-button fav-meal-button meal-{{ recipe.Recipe.recipe_id }} btn btn-block 
                              {% if recipe.app_user_id == current_user.id and recipe.active_ind == True %}
                              btn-danger" data-toggle="modal"
                data-target="#mealtime-modal-fav-confirm-delete-{{ recipe.Recipe.recipe_id }}">Remove from Meal
                Plan
                {% else %}
                btn-success" data-toggle="modal"
                data-target="#mealtime-modal-fav-{{ recipe.Recipe.recipe_id }}">Add to Meal Plan
                {% endif %}
              </button>


              <!-- Modal allowing user to add recipe to their meal plan -->
              <div class="modal fade" id="mealtime-modal-fav-{{ recipe.Recipe.recipe_id }}" tabindex="-1" role="dialog"
                aria-labelledby="mealtime-modal-fav-title" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="mealtime-modal-fav-title">Meal Selection</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <!-- Breakfast button -->
                      <div><button name="{{ recipe.Recipe.recipe_id }}"
                          class="btn btn-block modal-meal-button meal-breakfast meal-breakfast-fav {% if recipe.Recipe.meal_breakfast == True %} btn-success">Add
                          as Breakfast
                          Meal (Recommended)
                          {% else %}
                          btn-secondary">Add as Breakfast Meal
                          {% endif %}
                        </button>
                      </div>
                      <!-- Lunch button -->
                      <div><button name="{{ recipe.Recipe.recipe_id }}"
                          class="btn btn-block modal-meal-button meal-lunch meal-lunch-fav {% if recipe.Recipe.meal_lunch == True %} btn-success">Add
                          as Lunch
                          Meal (Recommended)
                          {% else %}
                          btn-secondary">Add as Lunch Meal
                          {% endif %}
                        </button>
                      </div>
                      <!-- Dinner button -->
                      <div><button name="{{ recipe.Recipe.recipe_id }}"
                          class="btn btn-block modal-meal-button meal-dinner meal-dinner-fav {% if recipe.Recipe.meal_dinner == True %} btn-success">Add
                          as Dinner
                          Meal (Recommended)
                          {% else %}
                          btn-secondary">Add as Dinner Meal
                          {% endif %}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Modal confirming to the user that the recipe was added to their meal plan -->
              <div class="modal fade mealtime-modal-fav-success"
                id="mealtime-modal-fav-success-{{ recipe.Recipe.recipe_id }}" tabindex="-1" role="dialog"
                aria-labelledby="mealtime-modal-fav-success-title" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="mealtime-modal-fav-success-title">Success</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <strong>{{ recipe.Recipe.recipe_name }}</strong> was added to your meal plan!
                    </div>
                    <div class="modal-footer">
                      <a href="{{ url_for('meal_plan') }}" class="btn btn-primary center">Go to Meal Plan</a>
                      <button type="button" class="btn btn-secondary center" data-dismiss="modal">
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>


              <!-- Modal prompting whether to delete recipe from their meal plan -->
              <div class="modal fade mealtime-modal-fav-confirm-delete"
                id="mealtime-modal-fav-confirm-delete-{{ recipe.Recipe.recipe_id }}" tabindex="-1" role="dialog"
                aria-labelledby="mealtime-modal-fav-confirm-delete-title" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="mealtime-modal-fav-confirm-delete-title">Confirm</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      Are you sure that you want to remove <strong>{{ recipe.Recipe.recipe_name }}</strong> from
                      your meal plan?
                    </div>
                    <!-- Button to proceed with removal -->
                    <div class="modal-footer">
                      <button type="button" class="btn btn-danger center meal-button-proceed" data-dismiss="modal">
                        Remove from Meal Plan
                      </button>
                      <!-- Button to cancel and close modal -->
                      <button type="button" class="btn btn-secondary center" data-dismiss="modal">
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <!-- Display button so that user can add the recipe to their favorites -->
            <div class="form-group col-sm">
              <button name="{{ recipe.Recipe.recipe_id }}" id="fav-{{ recipe.Recipe.recipe_id }}" class="favorite-button fav-{{ recipe.Recipe.recipe_id }} btn btn-block 
                          {% if recipe.Favorite_Recipe.app_user_id == current_user.id and recipe.Favorite_Recipe.favorite_recipe_id != None %}
                          btn-danger">Remove from Favorites
                {% else %}
                btn-success">Add to Favorites
                {% endif %}
              </button>
            </div>

          </div>
        </div>
        <hr class="recipe-list-hr" />
      </li>

      {% endfor %}

    </ul>

    <!-- If user doesn't have any Favorites, display placeholder message -->
    {% else %}
    <h5 class="text-center">There aren't any recipes yet. Try adding one!</h5>
    {% endif %}
  </div>

  </ul>

</div>



{% endblock %}

{% block footer %}
<script type="text/javascript" src="{{ url_for('static', filename='all_recipes.js') }}?v=1.08"></script>
{% endblock %}